---
layout: post
title:  "[모두를 위한 딥러닝2 Pytorch] CNN with mnist  "
date:   2021-01-23
desc: " "
keywords: "DL, ML"
categories: [Deeplearning]
tags: [DL, ML, pytorch]
icon: icon-html
---

🍳 reference: <모두를 위한 딥러닝 2: pytorch> Lab10


이제 본격적으로 CNN 시작!


<br>

# Convolution

![fig](https://miro.medium.com/max/1164/1*0I22V_Kaf-QowUA8IQRw5w.png)

이미지 위에서 `stride` 만큼 filter를 이동시키면서 겹쳐지는 부분의 각 element 값을 곱해서 모두 더한 값을 출력으로 하는 연산을 의미한다.


![fig](https://blog.kakaocdn.net/dn/46XO9/btqGeaVthvD/p5yHwE3zk2CPkfdL7j45r1/img.png)


`stride`는 얼마나 filter를 이동할 것인지를, `padding`은 가장자리 연산의 손실을 막기 위해 상하좌우에 0으로 가득찬 pad를 채워주는 것을 의미한다.

<br>


사실 CNN의 기본 원리, 각 용어의 개념(kernel, padding, pooling, ..)들은 [모모딥1](https://www.youtube.com/watch?v=Em63mknbtWo&list=PLlMkM4tgfjnLSOjrEJN31gZATbcj_MpUm&index=35)에서 훨씬 자세하게 나와있고,

이번 모모딥 2에서는 pytorch 버전 위주로 공부했다.

```python
import pytorch

conv = torch.nn.Conv2d(input_channel, output_channel, kernal_size, ...)
output = conv(input)
```

이 연산에서 `input`의 type은 torch.Tensor,  input의 shape 은 (batch size, channel, height, width) 이다.

![fig](https://miro.medium.com/fit/c/1796/541/1*3632mUO_Nf46Kr__ZSFpcg.png)

이때 output size = (input size - filter size + 2*padding)/stride + 1 이다.

만약 input size = 32x32, filter size(=filter size) = 5x5, stride = 1, padding = 2이면,

output size = (32-5+2*2)/1 + 1 = 31 이 된다.



```python
import torch

conv = torch.nn.Conv2d(1,1,5,stride = 1, padding = 2)
inputs = torch.Tensor(1,1,32,32)
out = conv(inputs)
print(out.shape)
# torch.Size([1, 1, 32, 32])
```



만약 input size = 32x64, filter size = 5x5, stride = 1, padding = 0이면,

output size = 28x60 이 된다.



```python
import torch

conv = torch.nn.Conv2d(1,1,5,stride = 1)
inputs = torch.Tensor(1,1,32,64)
out = conv(inputs)
print(out.shape)
# torch.Size([1, 1, 28, 60])
```

<br>

** CNN 에서는 Perceptron의 weight 값으로 filter가 적용된다. **

<br>



![fig](https://blog.kakaocdn.net/dn/dzTI4u/btqznO6jsqC/Jhq5kPYymM8Lsh3y7Kvovk/img.png)


pooling도 아래와 같이 사용할 수 있다.



```python
import torch

pool = torch.nn.MaxPool2d(kernal_size, stride, padding , ...)
```



<br>


이제 가장 간단한 CNN 모델을 만들어보자.


```python
import torch

conv1 = torch.nn.Conv2d(1,1,2,stride = 1)
pool = torch.nn.MaxPool2d(2)

inputs = torch.Tensor(1,1,28,28)
out1 = conv1(inputs)
out2 = pool(out1)
out1.size() #torch.Size([1, 1, 27, 27])
out2.size() #torch.Size([1, 1, 13, 13])
```


<br>
